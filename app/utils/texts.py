"""Text utilities and message templates."""

from app.db import db
from app.config import settings

WELCOME_TEXT = """
ü§ñ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AI Bot!</b>

–ü—Ä–∏–≤–µ—Ç, {name}! –Ø –≤–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º.

<b>–ß—Ç–æ —è —É–º–µ—é:</b>
üí¨ –í–µ—Å—Ç–∏ —É–º–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Å –ø–∞–º—è—Ç—å—é
üé® –°–æ–∑–¥–∞–≤–∞—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
üîä –†–∞–±–æ—Ç–∞—Ç—å —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
üõ† –ü–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (–í–∏–∫–∏–ø–µ–¥–∏—è, –ø–æ–≥–æ–¥–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä)
‚è∞ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
üí≥ –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã

{stats}

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –Ω–∏–∂–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º!
"""

PERSONA_DESCRIPTIONS = {
    'default': 'ü§ñ –û–±—ã—á–Ω—ã–π: –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫',
    'robot': 'ü§ñ –†–æ–±–æ—Ç: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∏ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç—ã',
    'listener': 'üëÇ –°–ª—É—à–∞—Ç–µ–ª—å: –≠–º–ø–∞—Ç–∏—á–Ω—ã–π –∏ –ø–æ–Ω–∏–º–∞—é—â–∏–π',
    'nerd': 'ü§ì –£–º–Ω–∏–∫: –î–µ—Ç–∞–ª—å–Ω—ã–π –∏ –Ω–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥',
    'cynic': 'üòè –¶–∏–Ω–∏–∫: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∏ —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å'
}

LANGUAGE_NAMES = {
    'ru': 'üá∑üá∫ –†—É—Å—Å–∫–∏–π',
    'en': 'üá¨üáß English'
}

PLAN_LIMITS = {
    'FREE': {
        'messages': settings.free_daily_messages,
        'images': settings.free_daily_images,
        'voice': settings.free_daily_voice,
        'name': 'FREE'
    },
    'PRO': {
        'messages': settings.pro_daily_messages,
        'images': settings.pro_daily_images,
        'voice': settings.pro_daily_voice,
        'name': 'PRO'
    },
    'TEAM': {
        'messages': settings.team_daily_messages,
        'images': settings.team_daily_images,
        'voice': settings.team_daily_voice,
        'name': 'TEAM'
    }
}


async def get_user_stats_text(user_id: int) -> str:
    """Get user's daily statistics text."""
    try:
        user = await db.get_user(user_id)
        plan = user['plan'] if user else 'FREE'
        
        # Get today's usage
        messages_used = await db.get_daily_usage(user_id, 'chat')
        images_used = await db.get_daily_usage(user_id, 'image')
        voice_used = await db.get_daily_usage(user_id, 'voice')
        
        # Get limits for current plan
        limits = PLAN_LIMITS.get(plan, PLAN_LIMITS['FREE'])
        
        stats = f"""
<b>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:</b>
üí¨ –°–æ–æ–±—â–µ–Ω–∏—è: {messages_used}/{limits['messages']}
üé® –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {images_used}/{limits['images']}
üîä –ì–æ–ª–æ—Å: {voice_used}/{limits['voice']}

üíé –í–∞—à —Ç–∞—Ä–∏—Ñ: <b>{limits['name']}</b>
"""
        return stats
        
    except Exception:
        return "\nüìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</b>"


def get_plan_info_text(plan: str) -> str:
    """Get plan information text."""
    if plan == 'FREE':
        return f"""
üíé <b>–¢–∞—Ä–∏—Ñ FREE</b>

<b>–í–∞—à–∏ –ª–∏–º–∏—Ç—ã:</b>
üí¨ –°–æ–æ–±—â–µ–Ω–∏—è: {settings.free_daily_messages}/–¥–µ–Ω—å
üé® –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {settings.free_daily_images}/–¥–µ–Ω—å
üîä –ì–æ–ª–æ—Å: {settings.free_daily_voice}/–¥–µ–Ω—å

–•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π? –û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ PRO –∏–ª–∏ TEAM!
"""
    elif plan == 'PRO':
        return f"""
‚≠ê <b>–¢–∞—Ä–∏—Ñ PRO</b>

<b>–í–∞—à–∏ –ª–∏–º–∏—Ç—ã:</b>
üí¨ –°–æ–æ–±—â–µ–Ω–∏—è: {settings.pro_daily_messages}/–¥–µ–Ω—å
üé® –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {settings.pro_daily_images}/–¥–µ–Ω—å  
üîä –ì–æ–ª–æ—Å: {settings.pro_daily_voice}/–¥–µ–Ω—å

<b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {settings.pro_price_rub}‚ÇΩ/–º–µ—Å—è—Ü
"""
    elif plan == 'TEAM':
        return f"""
üë• <b>–¢–∞—Ä–∏—Ñ TEAM</b>

<b>–í–∞—à–∏ –ª–∏–º–∏—Ç—ã:</b>
üí¨ –°–æ–æ–±—â–µ–Ω–∏—è: {settings.team_daily_messages}/–¥–µ–Ω—å
üé® –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {settings.team_daily_images}/–¥–µ–Ω—å
üîä –ì–æ–ª–æ—Å: {settings.team_daily_voice}/–¥–µ–Ω—å

<b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {settings.team_price_rub}‚ÇΩ/–º–µ—Å—è—Ü
"""
    
    return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ"


def get_menu_help_text(menu_type: str) -> str:
    """Get help text for menu options."""
    help_texts = {
        'chat': """
üí¨ <b>–†–µ–∂–∏–º —á–∞—Ç–∞</b>

–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —è –æ—Ç–≤–µ—á—É —Å –ø–æ–º–æ—â—å—é –ò–ò.
–Ø –∑–∞–ø–æ–º–∏–Ω–∞—é –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è.

<b>–ü—Ä–∏–º–µ—Ä—ã:</b>
‚Ä¢ "–†–∞—Å—Å–∫–∞–∂–∏ –æ –∫–≤–∞–Ω—Ç–æ–≤–æ–π —Ñ–∏–∑–∏–∫–µ"
‚Ä¢ "–ü–æ–º–æ–≥–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∏—Å—å–º–æ"
‚Ä¢ "–ß—Ç–æ –¥—É–º–∞–µ—à—å –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ?"
""",
        'image': """
üé® <b>–†–µ–∂–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</b>

<b>–ß—Ç–æ —è —É–º–µ—é:</b>
‚Ä¢ <b>–ê–Ω–∞–ª–∏–∑</b>: –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ, –∏ —è –µ–≥–æ –æ–ø–∏—à—É
‚Ä¢ <b>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</b>: –ù–∞–ø–∏—à–∏—Ç–µ "—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π [–æ–ø–∏—Å–∞–Ω–∏–µ]"
‚Ä¢ <b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</b>: –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º "–∏–∑–º–µ–Ω–∏ [–∫–∞–∫]"

<b>–ü—Ä–∏–º–µ—Ä—ã:</b>
‚Ä¢ "—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º"
‚Ä¢ "—Å–æ–∑–¥–∞–π –ª–æ–≥–æ—Ç–∏–ø –¥–ª—è –∫–∞—Ñ–µ"
‚Ä¢ [—Ñ–æ—Ç–æ] "–∏–∑–º–µ–Ω–∏ —Ü–≤–µ—Ç –Ω–∞ —Å–∏–Ω–∏–π"
""",
        'voice': """
üîä <b>–†–µ–∂–∏–º –≥–æ–ª–æ—Å–∞</b>

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —è:
1. –†–∞—Å–ø–æ–∑–Ω–∞—é —Ä–µ—á—å (Speech-to-Text)
2. –û–±—Ä–∞–±–æ—Ç–∞—é –∑–∞–ø—Ä–æ—Å —Å –ø–æ–º–æ—â—å—é –ò–ò
3. –û—Ç–≤–µ—á—É –≥–æ–ª–æ—Å–æ–º (Text-to-Speech)

–ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –∏ –Ω–µ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.
""",
        'tools': """
üõ† <b>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</b>

<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
‚Ä¢ <b>wiki [–∑–∞–ø—Ä–æ—Å]</b> - –ü–æ–∏—Å–∫ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏
‚Ä¢ <b>–ø–æ–≥–æ–¥–∞ [–≥–æ—Ä–æ–¥]</b> - –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã
‚Ä¢ <b>calc [–≤—ã—Ä–∞–∂–µ–Ω–∏–µ]</b> - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä

<b>–ü—Ä–∏–º–µ—Ä—ã:</b>
‚Ä¢ "wiki –≠–π–Ω—à—Ç–µ–π–Ω"
‚Ä¢ "–ø–æ–≥–æ–¥–∞ –ú–æ—Å–∫–≤–∞"
‚Ä¢ "calc 15*8+42"
""",
        'reminder': """
‚è∞ <b>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</b>

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.

<b>–§–æ—Ä–º–∞—Ç:</b>
"–Ω–∞–ø–æ–º–Ω–∏ [—Ç–µ–∫—Å—Ç] –≤ [–î–î.–ú–ú –ß–ß:–ú–ú]"

<b>–ü—Ä–∏–º–µ—Ä—ã:</b>
‚Ä¢ "–Ω–∞–ø–æ–º–Ω–∏ –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ –≤ 15.12 18:00"
‚Ä¢ "–Ω–∞–ø–æ–º–Ω–∏ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –º–∞–º–µ –≤ 25.12 10:30"
‚Ä¢ "–Ω–∞–ø–æ–º–Ω–∏ –≤—Å—Ç—Ä–µ—á–∞ —á–µ—Ä–µ–∑ —á–∞—Å"
""",
        'plan': """
üí≥ <b>–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã</b>

<b>FREE</b> - –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
<b>PRO (199‚ÇΩ/–º–µ—Å)</b> - –ë–æ–ª—å—à–µ –ª–∏–º–∏—Ç–æ–≤
<b>TEAM (799‚ÇΩ/–º–µ—Å)</b> - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø–ª–∞–Ω –Ω–∏–∂–µ.
"""
    }
    
    return help_texts.get(menu_type, "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞")


def get_usage_limit_text(action: str, used: int, limit: int) -> str:
    """Get usage limit warning text."""
    return f"""
‚ö†Ô∏è <b>–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω</b>

–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤—Å–µ {action} –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({used}/{limit}).

üíé –û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ PRO –∏–ª–∏ TEAM –¥–ª—è –±–æ–ª—å—à–∏—Ö –ª–∏–º–∏—Ç–æ–≤!
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /buy –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∞—Ä–∏—Ñ–æ–≤.
"""


SYSTEM_PROMPTS = {
    'default': "–¢—ã –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.",
    'robot': "–¢—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π AI-—Ä–æ–±–æ—Ç. –û—Ç–≤–µ—á–∞–π —Ç–æ—á–Ω–æ, —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ. –ò–∑–±–µ–≥–∞–π —ç–º–æ—Ü–∏–π.",
    'listener': "–¢—ã —ç–º–ø–∞—Ç–∏—á–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å –∏ –ø—Å–∏—Ö–æ–ª–æ–≥. –ü—Ä–æ—è–≤–ª—è–π –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –¥–∞–≤–∞–π –º—É–¥—Ä—ã–µ —Å–æ–≤–µ—Ç—ã.",
    'nerd': "–¢—ã —ç—Ä—É–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—á–µ–Ω—ã–π. –î–∞–≤–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ, –Ω–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —Ñ–∞–∫—Ç–∞–º–∏ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏.",
    'cynic': "–¢—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º—ã—Å–ª—è—â–∏–π —Ü–∏–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π —Å –¥–æ–ª–µ–π —Å–∫–µ–ø—Ç–∏—Ü–∏–∑–º–∞ –∏ —Å–∞—Ä–∫–∞–∑–º–∞, –Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ–ª–µ–∑–Ω—ã–º."
}