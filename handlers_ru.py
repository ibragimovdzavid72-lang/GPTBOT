"""–†—É—Å—Å–∫–∏–π –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –°–æ–æ–±—â–µ–Ω–∏–π"""

import asyncio
import time
from datetime import datetime
from typing import Any, Dict, List, Optional

import structlog
from config_ru import –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç, —ç—Ç–æ_–∞–¥–º–∏–Ω, –ø–æ–ª—É—á–∏—Ç—å_–ª–∏–º–∏—Ç—ã_—Ç–∞—Ä–∏—Ñ–∞

–ª–æ–≥ = structlog.get_logger("–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏")


class –û–±—Ä–∞–±–æ—Ç—á–∏–∫–°–æ–æ–±—â–µ–Ω–∏–π:
    """–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä—É—Å—Å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞."""
    
    def __init__(self, —Ç–µ–ª–µ–≥—Ä–∞–º_–∫–ª–∏–µ–Ω—Ç, –æ–ø–µ–Ω–∞–∏_–∫–ª–∏–µ–Ω—Ç, –º–µ–Ω–µ–¥–∂–µ—Ä_–±–¥, –º–µ–Ω–µ–¥–∂–µ—Ä_–ø–ª–∞—Ç–µ–∂–µ–π, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞_–¥–≤–∏–∂–æ–∫):
        self.—Ç–µ–ª–µ–≥—Ä–∞–º = —Ç–µ–ª–µ–≥—Ä–∞–º_–∫–ª–∏–µ–Ω—Ç
        self.–æ–ø–µ–Ω–∞–∏ = –æ–ø–µ–Ω–∞–∏_–∫–ª–∏–µ–Ω—Ç
        self.–±–¥ = –º–µ–Ω–µ–¥–∂–µ—Ä_–±–¥
        self.–ø–ª–∞—Ç–µ–∂–∏ = –º–µ–Ω–µ–¥–∂–µ—Ä_–ø–ª–∞—Ç–µ–∂–µ–π
        self.–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ = –∞–Ω–∞–ª–∏—Ç–∏–∫–∞_–¥–≤–∏–∂–æ–∫
        
        # –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
        self.—Å–æ—Å—Ç–æ—è–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = {}
    
    async def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(self, —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict[str, Any]):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."""
        –≤—Ä–µ–º—è_—Å—Ç–∞—Ä—Ç–∞ = time.perf_counter()
        
        try:
            –¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = —Å–æ–æ–±—â–µ–Ω–∏–µ.get("from", {})
            –∏–¥_—á–∞—Ç–∞ = —Å–æ–æ–±—â–µ–Ω–∏–µ["chat"]["id"]
            —Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥ = –¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è["id"]
            
            # –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = await self.–±–¥.–ø–æ–ª—É—á–∏—Ç—å_–∏–ª–∏_—Å–æ–∑–¥–∞—Ç—å_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(
                —Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥=—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥,
                –∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è=–¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.get("username"),
                –∏–º—è=–¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.get("first_name"),
                —Ñ–∞–º–∏–ª–∏—è=–¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.get("last_name"),
                –∫–æ–¥_—è–∑—ã–∫–∞=–¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.get("language_code", "ru")
            )
            
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:
                await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
                    –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                    —Ç–µ–∫—Å—Ç="‚ùå –í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã"
                )
                return
            
            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π
            if "text" in —Å–æ–æ–±—â–µ–Ω–∏–µ:
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—Ç–µ–∫—Å—Ç–æ–≤–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(—Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            elif "photo" in —Å–æ–æ–±—â–µ–Ω–∏–µ:
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—Ñ–æ—Ç–æ_—Å–æ–æ–±—â–µ–Ω–∏–µ(—Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            elif "voice" in —Å–æ–æ–±—â–µ–Ω–∏–µ:
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–≥–æ–ª–æ—Å–æ–≤–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(—Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            elif "document" in —Å–æ–æ–±—â–µ–Ω–∏–µ:
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–¥–æ–∫—É–º–µ–Ω—Ç_—Å–æ–æ–±—â–µ–Ω–∏–µ(—Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            
            # –ó–∞–ø–∏—Å–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
            –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å = time.perf_counter() - –≤—Ä–µ–º—è_—Å—Ç–∞—Ä—Ç–∞
            if self.–∞–Ω–∞–ª–∏—Ç–∏–∫–∞:
                self.–∞–Ω–∞–ª–∏—Ç–∏–∫–∞.–∑–∞–ø–∏—Å–∞—Ç—å_–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–¥, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
            
        except Exception as e:
            –ª–æ–≥.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è", –æ—à–∏–±–∫–∞=str(e))
    
    async def _–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—Ç–µ–∫—Å—Ç–æ–≤–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(self, —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict[str, Any], –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è."""
        —Ç–µ–∫—Å—Ç = —Å–æ–æ–±—â–µ–Ω–∏–µ["text"]
        –∏–¥_—á–∞—Ç–∞ = —Å–æ–æ–±—â–µ–Ω–∏–µ["chat"]["id"]
        
        # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã
        if —Ç–µ–∫—Å—Ç.startswith("/"):
            await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–º–∞–Ω–¥—É(—Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            return
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –≤–≤–æ–¥–æ–≤
        —Å–æ—Å—Ç–æ—è–Ω–∏–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = self.—Å–æ—Å—Ç–æ—è–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.get(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥)
        if —Å–æ—Å—Ç–æ—è–Ω–∏–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
            await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–≤–≤–æ–¥_—Å–æ—Å—Ç–æ—è–Ω–∏—è(—Ç–µ–∫—Å—Ç, —Å–æ—Å—Ç–æ—è–Ω–∏–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            return
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã
        –ª–∏–º–∏—Ç—ã = await self.–±–¥.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–ª–∏–º–∏—Ç—ã_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥)
        if not –ª–∏–º–∏—Ç—ã["–º–æ–∂–µ—Ç_–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ"]:
            await self._–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ_–ª–∏–º–∏—Ç–æ–≤(–∏–¥_—á–∞—Ç–∞, –ª–∏–º–∏—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
            return
        
        # –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        if –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.–≤–∫–ª—é—á–∏—Ç—å_–º–æ–¥–µ—Ä–∞—Ü–∏—é_–∫–æ–Ω—Ç–µ–Ω—Ç–∞:
            –º–æ–¥–µ—Ä–∞—Ü–∏—è = await self.–æ–ø–µ–Ω–∞–∏.–º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–∫–æ–Ω—Ç–µ–Ω—Ç(—Ç–µ–∫—Å—Ç)
            if –º–æ–¥–µ—Ä–∞—Ü–∏—è["–ø–æ–º–µ—á–µ–Ω–æ"]:
                await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
                    –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                    —Ç–µ–∫—Å—Ç=–ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–æ—à–∏–±–∫–∞_–º–æ–¥–µ—Ä–∞—Ü–∏–∏", –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
                )
                return
        
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ø–µ—á–∞—Ç–∞–µ—Ç
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–µ—á–∞—Ç–∞–µ—Ç(–∏–¥_—á–∞—Ç–∞)
        
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è OpenAI
        —Å–æ–æ–±—â–µ–Ω–∏—è = [
            {"role": "user", "content": —Ç–µ–∫—Å—Ç}
        ]
        
        # –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
        –æ—Ç–≤–µ—Ç = await self.–æ–ø–µ–Ω–∞–∏.–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ_—á–∞—Ç–∞(
            —Å–æ–æ–±—â–µ–Ω–∏—è=—Å–æ–æ–±—â–µ–Ω–∏—è,
            –∏–¥_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è=–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–¥,
            –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã=True
        )
        
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
            –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
            —Ç–µ–∫—Å—Ç=–æ—Ç–≤–µ—Ç["—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ"],
            —Ä–∞–∑–º–µ—Ç–∫–∞_–æ—Ç–≤–µ—Ç–∞=self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–æ–ª—É—á–∏—Ç—å_–≥–ª–∞–≤–Ω–æ–µ_–º–µ–Ω—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞, —ç—Ç–æ_–∞–¥–º–∏–Ω(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥))
        )
        
        # –û–±–Ω–æ–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
        await self.–±–¥.—É–≤–µ–ª–∏—á–∏—Ç—å_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥, "—Å–æ–æ–±—â–µ–Ω–∏—è", 1)
    
    async def _–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–º–∞–Ω–¥—É(self, —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict[str, Any], –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞."""
        —Ç–µ–∫—Å—Ç = —Å–æ–æ–±—â–µ–Ω–∏–µ["text"]
        –∏–¥_—á–∞—Ç–∞ = —Å–æ–æ–±—â–µ–Ω–∏–µ["chat"]["id"]
        –∫–æ–º–∞–Ω–¥–∞ = —Ç–µ–∫—Å—Ç.split()[0].lower()
        
        if –∫–æ–º–∞–Ω–¥–∞ == "/start":
            await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–º–∞–Ω–¥—É_—Å—Ç–∞—Ä—Ç(–∏–¥_—á–∞—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
        elif –∫–æ–º–∞–Ω–¥–∞ == "/help":
            await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–º–∞–Ω–¥—É_–ø–æ–º–æ—â—å(–∏–¥_—á–∞—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
        elif –∫–æ–º–∞–Ω–¥–∞ == "/stats" and —ç—Ç–æ_–∞–¥–º–∏–Ω(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥):
            await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–º–∞–Ω–¥—É_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞(–∏–¥_—á–∞—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    
    async def _–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–º–∞–Ω–¥—É_—Å—Ç–∞—Ä—Ç(self, –∏–¥_—á–∞—Ç–∞: int, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /start."""
        —Ç–µ–∫—Å—Ç_–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è = –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ", –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
        –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–æ–ª—É—á–∏—Ç—å_–≥–ª–∞–≤–Ω–æ–µ_–º–µ–Ω—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞, —ç—Ç–æ_–∞–¥–º–∏–Ω(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥))
        
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
            –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
            —Ç–µ–∫—Å—Ç=—Ç–µ–∫—Å—Ç_–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è,
            —Ä–∞–∑–º–µ—Ç–∫–∞_–æ—Ç–≤–µ—Ç–∞=–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        )
    
    async def _–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—Ñ–æ—Ç–æ_—Å–æ–æ–±—â–µ–Ω–∏–µ(self, —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict[str, Any], –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–æ—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è."""
        if not –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.—Ñ—É–Ω–∫—Ü–∏–∏.–≤–∫–ª—é—á–∏—Ç—å_–≤–∏–¥–µ–Ω–∏–µ:
            return
        
        –∏–¥_—á–∞—Ç–∞ = —Å–æ–æ–±—â–µ–Ω–∏–µ["chat"]["id"]
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã
        –ª–∏–º–∏—Ç—ã = await self.–±–¥.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–ª–∏–º–∏—Ç—ã_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥)
        if not –ª–∏–º–∏—Ç—ã["–º–æ–∂–µ—Ç_–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ"]:
            await self._–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ_–ª–∏–º–∏—Ç–æ–≤(–∏–¥_—á–∞—Ç–∞, –ª–∏–º–∏—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
            return
        
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–¥–µ–π—Å—Ç–≤–∏–µ_—á–∞—Ç–∞(–∏–¥_—á–∞—Ç–∞, "typing")
        
        try:
            # –ü–æ–ª—É—á–∏—Ç—å —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ —Ñ–æ—Ç–æ
            —Ñ–æ—Ç–æ = max(—Å–æ–æ–±—â–µ–Ω–∏–µ["photo"], key=lambda x: x.get("file_size", 0))
            
            # –°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            –ø–æ–¥–ø–∏—Å—å = —Å–æ–æ–±—â–µ–Ω–∏–µ.get("caption", "–û–ø–∏—à–∏—Ç–µ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ")
            –∞–Ω–∞–ª–∏–∑ = f"üîç **–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**\n\n–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è... \n\nüì∏ –û–ø–∏—Å–∞–Ω–∏–µ: {–ø–æ–¥–ø–∏—Å—å}"
            
            await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
                –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                —Ç–µ–∫—Å—Ç=–∞–Ω–∞–ª–∏–∑,
                –æ—Ç–≤–µ—Ç_–Ω–∞_—Å–æ–æ–±—â–µ–Ω–∏–µ_–∏–¥=—Å–æ–æ–±—â–µ–Ω–∏–µ["message_id"]
            )
            
        except Exception as e:
            –ª–æ–≥.error("–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –Ω–µ —É–¥–∞–ª—Å—è", –æ—à–∏–±–∫–∞=str(e))
            await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
                –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                —Ç–µ–∫—Å—Ç=–ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–æ—à–∏–±–∫–∞_–æ–±—â–∞—è", –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
            )
    
    async def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å(self, –∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å: Dict[str, Any]):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ª–±–µ–∫ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∏–Ω–ª–∞–π–Ω –∫–ª–∞–≤–∏–∞—Ç—É—Ä."""
        try:
            –∏–¥_–∑–∞–ø—Ä–æ—Å–∞ = –∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å["id"]
            –¥–∞–Ω–Ω—ã–µ = –∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å["data"]
            —Å–æ–æ–±—â–µ–Ω–∏–µ = –∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å["message"]
            –¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = –∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å["from"]
            
            –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = await self.–±–¥.–ø–æ–ª—É—á–∏—Ç—å_–∏–ª–∏_—Å–æ–∑–¥–∞—Ç—å_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(–¥–∞–Ω–Ω—ã–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è["id"])
            if not –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
                await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–≤–µ—Ç–∏—Ç—å_–Ω–∞_–∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å(–∏–¥_–∑–∞–ø—Ä–æ—Å–∞, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return
            
            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∫–æ–ª–±–µ–∫–æ–≤
            if –¥–∞–Ω–Ω—ã–µ.startswith("–≥–ª–∞–≤–Ω–æ–µ_"):
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–ª–±–µ–∫_–≥–ª–∞–≤–Ω–æ–≥–æ_–º–µ–Ω—é(–¥–∞–Ω–Ω—ã–µ, —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–¥_–∑–∞–ø—Ä–æ—Å–∞)
            elif –¥–∞–Ω–Ω—ã–µ.startswith("–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç_"):
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–ª–±–µ–∫_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞(–¥–∞–Ω–Ω—ã–µ, —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–¥_–∑–∞–ø—Ä–æ—Å–∞)
            elif –¥–∞–Ω–Ω—ã–µ.startswith("–∞–¥–º–∏–Ω_"):
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–ª–±–µ–∫_–∞–¥–º–∏–Ω–∞(–¥–∞–Ω–Ω—ã–µ, —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–¥_–∑–∞–ø—Ä–æ—Å–∞)
            elif –¥–∞–Ω–Ω—ã–µ.startswith("–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è_"):
                await self._–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–ª–±–µ–∫_–ø–æ–¥–ø–∏—Å–∫–∏(–¥–∞–Ω–Ω—ã–µ, —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–¥_–∑–∞–ø—Ä–æ—Å–∞)
            
        except Exception as e:
            –ª–æ–≥.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–ª–±–µ–∫ –∑–∞–ø—Ä–æ—Å–∞", –æ—à–∏–±–∫–∞=str(e))
    
    async def _–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∫–æ–ª–±–µ–∫_–≥–ª–∞–≤–Ω–æ–≥–æ_–º–µ–Ω—é(self, –¥–∞–Ω–Ω—ã–µ: str, —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–¥_–∑–∞–ø—Ä–æ—Å–∞: str):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ª–±–µ–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é."""
        –∏–¥_—á–∞—Ç–∞ = —Å–æ–æ–±—â–µ–Ω–∏–µ["chat"]["id"]
        –∏–¥_—Å–æ–æ–±—â–µ–Ω–∏—è = —Å–æ–æ–±—â–µ–Ω–∏–µ["message_id"]
        
        if –¥–∞–Ω–Ω—ã–µ == "–≥–ª–∞–≤–Ω–æ–µ_—á–∞—Ç":
            —Ç–µ–∫—Å—Ç = "üí¨ –†–µ–∂–∏–º —á–∞—Ç–∞ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!"
            –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–æ–ª—É—á–∏—Ç—å_–≥–ª–∞–≤–Ω–æ–µ_–º–µ–Ω—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞, —ç—Ç–æ_–∞–¥–º–∏–Ω(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥))
        elif –¥–∞–Ω–Ω—ã–µ == "–≥–ª–∞–≤–Ω–æ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è":
            —Ç–µ–∫—Å—Ç = "üé® –û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å:"
            self.—Å–æ—Å—Ç–æ—è–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π[–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥] = {"—Å–æ—Å—Ç–æ—è–Ω–∏–µ": "–æ–∂–∏–¥–∞–Ω–∏–µ_–ø—Ä–æ–º–ø—Ç–∞_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"}
            –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = None
        elif –¥–∞–Ω–Ω—ã–µ == "–≥–ª–∞–≤–Ω–æ–µ_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã":
            —Ç–µ–∫—Å—Ç = "üõ† –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:"
            –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–æ–ª—É—á–∏—Ç—å_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
        elif –¥–∞–Ω–Ω—ã–µ == "–≥–ª–∞–≤–Ω–æ–µ_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏":
            —Ç–µ–∫—Å—Ç = "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:"
            –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = self._–ø–æ–ª—É—á–∏—Ç—å_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É_–Ω–∞—Å—Ç—Ä–æ–µ–∫(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
        elif –¥–∞–Ω–Ω—ã–µ == "–≥–ª–∞–≤–Ω–æ–µ_–ø–æ–º–æ—â—å":
            —Ç–µ–∫—Å—Ç = –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–ø–æ–º–æ—â—å", –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
            –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–æ–ª—É—á–∏—Ç—å_–≥–ª–∞–≤–Ω–æ–µ_–º–µ–Ω—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞, —ç—Ç–æ_–∞–¥–º–∏–Ω(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥))
        else:
            —Ç–µ–∫—Å—Ç = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞"
            –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = None
        
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å_—Ç–µ–∫—Å—Ç_—Å–æ–æ–±—â–µ–Ω–∏—è(
            –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
            –∏–¥_—Å–æ–æ–±—â–µ–Ω–∏—è=–∏–¥_—Å–æ–æ–±—â–µ–Ω–∏—è,
            —Ç–µ–∫—Å—Ç=—Ç–µ–∫—Å—Ç,
            —Ä–∞–∑–º–µ—Ç–∫–∞_–æ—Ç–≤–µ—Ç–∞=–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        )
        
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–≤–µ—Ç–∏—Ç—å_–Ω–∞_–∫–æ–ª–±–µ–∫_–∑–∞–ø—Ä–æ—Å(–∏–¥_–∑–∞–ø—Ä–æ—Å–∞)
    
    def _–ø–æ–ª—É—á–∏—Ç—å_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É_–Ω–∞—Å—Ç—Ä–æ–µ–∫(self, —è–∑—ã–∫_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: str = "ru") -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞—Å—Ç—Ä–æ–µ–∫."""
        –∫–Ω–æ–ø–∫–∏ = [
            [
                {"text": –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–∫–Ω–æ–ø–∫–∞_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", —è–∑—ã–∫_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), "callback_data": "–Ω–∞—Å—Ç—Ä–æ–π–∫–∏_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"},
                {"text": –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–∫–Ω–æ–ø–∫–∞_–ø–æ–¥–ø–∏—Å–∫–∞", —è–∑—ã–∫_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), "callback_data": "–Ω–∞—Å—Ç—Ä–æ–π–∫–∏_–ø–æ–¥–ø–∏—Å–∫–∞"}
            ],
            [
                {"text": –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–∫–Ω–æ–ø–∫–∞_–Ω–∞–∑–∞–¥", —è–∑—ã–∫_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), "callback_data": "–≥–ª–∞–≤–Ω–æ–µ_–º–µ–Ω—é"}
            ]
        ]
        
        return self.—Ç–µ–ª–µ–≥—Ä–∞–º.—Å–æ–∑–¥–∞—Ç—å_–∏–Ω–ª–∞–π–Ω_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É(–∫–Ω–æ–ø–∫–∏)
    
    async def _–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ_–ª–∏–º–∏—Ç–æ–≤(self, –∏–¥_—á–∞—Ç–∞: int, –ª–∏–º–∏—Ç—ã: Dict, —è–∑—ã–∫: str):
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤."""
        —Ç–µ–∫—Å—Ç = –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–ª–∏–º–∏—Ç—ã_–ø—Ä–µ–≤—ã—à–µ–Ω—ã", —è–∑—ã–∫,
                              –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ_—Å–æ–æ–±—â–µ–Ω–∏–π=–ª–∏–º–∏—Ç—ã["–ª–∏–º–∏—Ç—ã"]["—Å–æ–æ–±—â–µ–Ω–∏—è"]["–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ"],
                              –ª–∏–º–∏—Ç_—Å–æ–æ–±—â–µ–Ω–∏–π=–ª–∏–º–∏—Ç—ã["–ª–∏–º–∏—Ç—ã"]["—Å–æ–æ–±—â–µ–Ω–∏—è"]["–ª–∏–º–∏—Ç"],
                              –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π=–ª–∏–º–∏—Ç—ã["–ª–∏–º–∏—Ç—ã"]["–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"]["–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ"],
                              –ª–∏–º–∏—Ç_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π=–ª–∏–º–∏—Ç—ã["–ª–∏–º–∏—Ç—ã"]["–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"]["–ª–∏–º–∏—Ç"])
        
        –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = self.—Ç–µ–ª–µ–≥—Ä–∞–º.–ø–æ–ª—É—á–∏—Ç—å_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É_–ø–æ–¥–ø–∏—Å–∫–∏(—è–∑—ã–∫)
        
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
            –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
            —Ç–µ–∫—Å—Ç=—Ç–µ–∫—Å—Ç,
            —Ä–∞–∑–º–µ—Ç–∫–∞_–æ—Ç–≤–µ—Ç–∞=–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        )
    
    async def _–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–≤–≤–æ–¥_—Å–æ—Å—Ç–æ—è–Ω–∏—è(self, —Ç–µ–∫—Å—Ç: str, —Å–æ—Å—Ç–æ—è–Ω–∏–µ: Dict, —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        –∏–¥_—á–∞—Ç–∞ = —Å–æ–æ–±—â–µ–Ω–∏–µ["chat"]["id"]
        
        if —Å–æ—Å—Ç–æ—è–Ω–∏–µ["—Å–æ—Å—Ç–æ—è–Ω–∏–µ"] == "–æ–∂–∏–¥–∞–Ω–∏–µ_–ø—Ä–æ–º–ø—Ç–∞_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è":
            await self._—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ(—Ç–µ–∫—Å—Ç, –∏–¥_—á–∞—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            del self.—Å–æ—Å—Ç–æ—è–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π[–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥]
        elif —Å–æ—Å—Ç–æ—è–Ω–∏–µ["—Å–æ—Å—Ç–æ—è–Ω–∏–µ"] == "–æ–∂–∏–¥–∞–Ω–∏–µ_–≥–æ—Ä–æ–¥–∞_–ø–æ–≥–æ–¥—ã":
            await self._–ø–æ–ª—É—á–∏—Ç—å_–ø–æ–≥–æ–¥—É(—Ç–µ–∫—Å—Ç, –∏–¥_—á–∞—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
            del self.—Å–æ—Å—Ç–æ—è–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π[–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥]
    
    async def _—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ(self, –ø—Ä–æ–º–ø—Ç: str, –∏–¥_—á–∞—Ç–∞: int, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å DALL-E."""
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã
        –ª–∏–º–∏—Ç—ã = await self.–±–¥.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_–ª–∏–º–∏—Ç—ã_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥)
        if not –ª–∏–º–∏—Ç—ã["–º–æ–∂–µ—Ç_—Å–æ–∑–¥–∞—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"]:
            await self._–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ_–ª–∏–º–∏—Ç–æ–≤(–∏–¥_—á–∞—Ç–∞, –ª–∏–º–∏—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
            return
        
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–∑–∞–≥—Ä—É–∂–∞–µ—Ç_—Ñ–æ—Ç–æ(–∏–¥_—á–∞—Ç–∞)
        
        try:
            # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç = await self.–æ–ø–µ–Ω–∞–∏.—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ(–ø—Ä–æ–º–ø—Ç, –∏–¥_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è=–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∏–¥)
            
            # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Ñ–æ—Ç–æ(
                –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                —Ñ–æ—Ç–æ=—Ä–µ–∑—É–ª—å—Ç–∞—Ç["—Å—Å—ã–ª–∫–∞"],
                –ø–æ–¥–ø–∏—Å—å=f"üé® **–°–æ–∑–¥–∞–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É:** {–ø—Ä–æ–º–ø—Ç}"
            )
            
            # –û–±–Ω–æ–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
            await self.–±–¥.—É–≤–µ–ª–∏—á–∏—Ç—å_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.—Ç–µ–ª–µ–≥—Ä–∞–º_–∏–¥, "–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è", 1)
            
        except Exception as e:
            –ª–æ–≥.error("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å", –æ—à–∏–±–∫–∞=str(e))
            await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
                –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                —Ç–µ–∫—Å—Ç=–ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç("–æ—à–∏–±–∫–∞_–æ–±—â–∞—è", –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.–∫–æ–¥_—è–∑—ã–∫–∞)
            )
    
    async def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–∏–Ω–ª–∞–π–Ω_–∑–∞–ø—Ä–æ—Å(self, –∏–Ω–ª–∞–π–Ω_–∑–∞–ø—Ä–æ—Å: Dict[str, Any]):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–ª–∞–π–Ω –∑–∞–ø—Ä–æ—Å—ã."""
        # –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω–ª–∞–π–Ω –∑–∞–ø—Ä–æ—Å–æ–≤
        –∏–¥_–∑–∞–ø—Ä–æ—Å–∞ = –∏–Ω–ª–∞–π–Ω_–∑–∞–ø—Ä–æ—Å["id"]
        
        # –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ–º –ø—É—Å—Ç—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
        await self.—Ç–µ–ª–µ–≥—Ä–∞–º._—Å–¥–µ–ª–∞—Ç—å_–∑–∞–ø—Ä–æ—Å("answerInlineQuery", json={
            "inline_query_id": –∏–¥_–∑–∞–ø—Ä–æ—Å–∞,
            "results": []
        })