"""–ü–ª–∞—Ç–µ–∂–∏ –∏ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –†—É—Å—Å–∫–æ–≥–æ –ë–æ—Ç–∞"""

import json
import time
from datetime import datetime, timedelta
from typing import Any, Dict, Optional

import structlog
from config_ru import –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –¢–ê–†–ò–§–´_–ü–û–î–ü–ò–°–û–ö, –ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç

–ª–æ–≥ = structlog.get_logger("–ø–ª–∞—Ç–µ–∂–∏_–∞–Ω–∞–ª–∏—Ç–∏–∫–∞")


class –ú–µ–Ω–µ–¥–∂–µ—Ä–ü–ª–∞—Ç–µ–∂–µ–π:
    """–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –±–æ—Ç–∞."""
    
    def __init__(self, —Ç–µ–ª–µ–≥—Ä–∞–º_–∫–ª–∏–µ–Ω—Ç, –º–µ–Ω–µ–¥–∂–µ—Ä_–±–¥):
        self.—Ç–µ–ª–µ–≥—Ä–∞–º = —Ç–µ–ª–µ–≥—Ä–∞–º_–∫–ª–∏–µ–Ω—Ç
        self.–±–¥ = –º–µ–Ω–µ–¥–∂–µ—Ä_–±–¥
        
        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π
        self.—Ç–æ–∫–µ–Ω_–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ = –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.—Ç–µ–ª–µ–≥—Ä–∞–º.—Ç–æ–∫–µ–Ω_–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞_–ø–ª–∞—Ç–µ–∂–µ–π
        self.–≤–∞–ª—é—Ç–∞ = "RUB"
    
    async def —Å–æ–∑–¥–∞—Ç—å_—Å—á–µ—Ç_–ø–æ–¥–ø–∏—Å–∫–∏(self, –∏–¥_—á–∞—Ç–∞: int, —Ç–∞—Ä–∏—Ñ: str, —è–∑—ã–∫_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: str = "ru"):
        """–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏."""
        if —Ç–∞—Ä–∏—Ñ not in –¢–ê–†–ò–§–´_–ü–û–î–ü–ò–°–û–ö:
            raise ValueError(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ: {—Ç–∞—Ä–∏—Ñ}")
        
        –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞ = –¢–ê–†–ò–§–´_–ü–û–î–ü–ò–°–û–ö[—Ç–∞—Ä–∏—Ñ]
        
        # –°–æ–∑–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞
        –ø–æ–ª–µ–∑–Ω–∞—è_–Ω–∞–≥—Ä—É–∑–∫–∞ = json.dumps({
            "—Ç–∞—Ä–∏—Ñ": —Ç–∞—Ä–∏—Ñ,
            "–¥–Ω–µ–π_–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏": 30,
            "–≤—Ä–µ–º–µ–Ω–Ω–∞—è_–º–µ—Ç–∫–∞": int(time.time())
        })
        
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–∞
        –∑–∞–≥–æ–ª–æ–≤–æ–∫ = f"–ü–æ–¥–ø–∏—Å–∫–∞ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.–Ω–∞–∑–≤–∞–Ω–∏–µ}"
        –æ–ø–∏—Å–∞–Ω–∏–µ = f"""–ü–æ–¥–ø–∏—Å–∫–∞ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.–Ω–∞–∑–≤–∞–Ω–∏–µ} –Ω–∞ 30 –¥–Ω–µ–π

‚úÖ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.—Å–æ–æ–±—â–µ–Ω–∏–π_–≤_–¥–µ–Ω—å} —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å
‚úÖ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π_–≤_–¥–µ–Ω—å} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –¥–µ–Ω—å  
‚úÖ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.–º–∏–Ω—É—Ç_–≥–æ–ª–æ—Å–∞_–≤_–¥–µ–Ω—å} –º–∏–Ω—É—Ç –≥–æ–ª–æ—Å–∞ –≤ –¥–µ–Ω—å
‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"""
        
        —Ü–µ–Ω—ã = [
            {"label": f"–ü–æ–¥–ø–∏—Å–∫–∞ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.–Ω–∞–∑–≤–∞–Ω–∏–µ}", "amount": –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.—Ü–µ–Ω–∞_—Ä—É–±–ª–µ–π * 100}
        ]
        
        try:
            # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—á–µ—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            await self.—Ç–µ–ª–µ–≥—Ä–∞–º.–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ(
                –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞,
                —Ç–µ–∫—Å—Ç=f"üí≥ **–°—á–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.–Ω–∞–∑–≤–∞–Ω–∏–µ}**\n\n{–æ–ø–∏—Å–∞–Ω–∏–µ}\n\nüí∞ –¶–µ–Ω–∞: {–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è_—Ç–∞—Ä–∏—Ñ–∞.—Ü–µ–Ω–∞_—Ä—É–±–ª–µ–π}‚ÇΩ/–º–µ—Å—è—Ü"
            )
            
            –ª–æ–≥.info("–°—á–µ—Ç —Å–æ–∑–¥–∞–Ω", —Ç–∞—Ä–∏—Ñ=—Ç–∞—Ä–∏—Ñ, –∏–¥_—á–∞—Ç–∞=–∏–¥_—á–∞—Ç–∞)
            return True
            
        except Exception as e:
            –ª–æ–≥.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç", –æ—à–∏–±–∫–∞=str(e))
            raise
    
    async def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π_–ø–ª–∞—Ç–µ–∂(self, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π_–ø–ª–∞—Ç–µ–∂: Dict[str, Any]):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–ª–∞—Ç–µ–∂–∞."""
        # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è - –≤—Å–µ–≥–¥–∞ –æ–¥–æ–±—Ä—è–µ–º
        –ª–æ–≥.info("–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂ –æ–¥–æ–±—Ä–µ–Ω")
    
    async def –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å_—É—Å–ø–µ—à–Ω—ã–π_–ø–ª–∞—Ç–µ–∂(self, –ø–ª–∞—Ç–µ–∂: Dict[str, Any], —Å–æ–æ–±—â–µ–Ω–∏–µ: Dict[str, Any]):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂."""
        –ª–æ–≥.info("–ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω")


class –ê–Ω–∞–ª–∏—Ç–∏–∫–∞–î–≤–∏–∂–æ–∫:
    """–î–≤–∏–∂–æ–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –±–æ—Ç–∞."""
    
    def __init__(self, –º–µ–Ω–µ–¥–∂–µ—Ä_–±–¥):
        self.–±–¥ = –º–µ–Ω–µ–¥–∂–µ—Ä_–±–¥
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤ = []
        self.—Å—á–µ—Ç—á–∏–∫_–æ—à–∏–±–æ–∫ = 0
        self.—Å—á–µ—Ç—á–∏–∫_—Å–æ–æ–±—â–µ–Ω–∏–π = 0
        self.–ø–æ—Å–ª–µ–¥–Ω–∏–π_—Å–±—Ä–æ—Å = datetime.utcnow()
    
    def –∑–∞–ø–∏—Å–∞—Ç—å_–Ω–∞—á–∞–ª–æ_–∑–∞–ø—Ä–æ—Å–∞(self):
        """–ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞."""
        pass
    
    def –∑–∞–ø–∏—Å–∞—Ç—å_–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ_–∑–∞–ø—Ä–æ—Å–∞(self, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: float, —É—Å–ø–µ—Ö: bool):
        """–ó–∞–ø–∏—Å–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞."""
        self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤.append((datetime.utcnow(), –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—Å–ø–µ—Ö))
        
        # –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Å–∞
        –æ–±—Ä–µ–∑ = datetime.utcnow() - timedelta(hours=1)
        self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤ = [
            (ts, dur, succ) for ts, dur, succ in self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤
            if ts > –æ–±—Ä–µ–∑
        ]
        
        if not —É—Å–ø–µ—Ö:
            self.—Å—á–µ—Ç—á–∏–∫_–æ—à–∏–±–æ–∫ += 1
    
    def –∑–∞–ø–∏—Å–∞—Ç—å_–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(self, –∏–¥_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: int, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: float):
        """–ó–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."""
        self.—Å—á–µ—Ç—á–∏–∫_—Å–æ–æ–±—â–µ–Ω–∏–π += 1
        self.–∑–∞–ø–∏—Å–∞—Ç—å_–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ_–∑–∞–ø—Ä–æ—Å–∞(–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, True)
    
    def –∑–∞–ø–∏—Å–∞—Ç—å_–æ—à–∏–±–∫—É(self, —Ç–∏–ø_–æ—à–∏–±–∫–∏: str):
        """–ó–∞–ø–∏—Å–∞—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –æ—à–∏–±–∫–∏."""
        self.—Å—á–µ—Ç—á–∏–∫_–æ—à–∏–±–æ–∫ += 1
        –ª–æ–≥.warning("–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∞–Ω–∞", —Ç–∏–ø_–æ—à–∏–±–∫–∏=—Ç–∏–ø_–æ—à–∏–±–∫–∏)
    
    async def –ø–æ–ª—É—á–∏—Ç—å_—Å–∏—Å—Ç–µ–º–Ω—É—é_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É(self) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É."""
        try:
            # –ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ = await self.–±–¥.–ø–æ–ª—É—á–∏—Ç—å_—Å–∏—Å—Ç–µ–º–Ω—É—é_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É()
            
            # –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            —Å—Ä–µ–¥–Ω–µ–µ_–≤—Ä–µ–º—è_–æ—Ç–≤–µ—Ç–∞ = self._–≤—ã—á–∏—Å–ª–∏—Ç—å_—Å—Ä–µ–¥–Ω–µ–µ_–≤—Ä–µ–º—è_–æ—Ç–≤–µ—Ç–∞()
            —á–∞—Å—Ç–æ—Ç–∞_–æ—à–∏–±–æ–∫ = self._–≤—ã—á–∏—Å–ª–∏—Ç—å_—á–∞—Å—Ç–æ—Ç—É_–æ—à–∏–±–æ–∫()
            
            —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.update({
                "—Å—Ä–µ–¥–Ω–µ–µ_–≤—Ä–µ–º—è_–æ—Ç–≤–µ—Ç–∞": —Å—Ä–µ–¥–Ω–µ–µ_–≤—Ä–µ–º—è_–æ—Ç–≤–µ—Ç–∞,
                "—á–∞—Å—Ç–æ—Ç–∞_–æ—à–∏–±–æ–∫": —á–∞—Å—Ç–æ—Ç–∞_–æ—à–∏–±–æ–∫,
                "–∑–∞–ø—Ä–æ—Å–æ–≤_–∑–∞_–ø–æ—Å–ª–µ–¥–Ω–∏–π_—á–∞—Å": len(self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤),
                "–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ_—Å–æ–æ–±—â–µ–Ω–∏–π": self.—Å—á–µ—Ç—á–∏–∫_—Å–æ–æ–±—â–µ–Ω–∏–π
            })
            
            return —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            
        except Exception as e:
            –ª–æ–≥.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É", –æ—à–∏–±–∫–∞=str(e))
            return {}
    
    def _–≤—ã—á–∏—Å–ª–∏—Ç—å_—Å—Ä–µ–¥–Ω–µ–µ_–≤—Ä–µ–º—è_–æ—Ç–≤–µ—Ç–∞(self) -> float:
        """–í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞."""
        if not self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤:
            return 0.0
        
        —É—Å–ø–µ—à–Ω—ã–µ_–∑–∞–ø—Ä–æ—Å—ã = [
            –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å for _, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—Å–ø–µ—Ö in self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤
            if —É—Å–ø–µ—Ö
        ]
        
        if not —É—Å–ø–µ—à–Ω—ã–µ_–∑–∞–ø—Ä–æ—Å—ã:
            return 0.0
        
        return sum(—É—Å–ø–µ—à–Ω—ã–µ_–∑–∞–ø—Ä–æ—Å—ã) / len(—É—Å–ø–µ—à–Ω—ã–µ_–∑–∞–ø—Ä–æ—Å—ã)
    
    def _–≤—ã—á–∏—Å–ª–∏—Ç—å_—á–∞—Å—Ç–æ—Ç—É_–æ—à–∏–±–æ–∫(self) -> float:
        """–í—ã—á–∏—Å–ª–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ—à–∏–±–æ–∫ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö."""
        if not self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤:
            return 0.0
        
        –æ–±—â–µ–µ_–∑–∞–ø—Ä–æ—Å–æ–≤ = len(self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤)
        –Ω–µ—É–¥–∞—á–Ω—ã—Ö_–∑–∞–ø—Ä–æ—Å–æ–≤ = sum(
            1 for _, _, —É—Å–ø–µ—Ö in self.–≤—Ä–µ–º–µ–Ω–∞_–∑–∞–ø—Ä–æ—Å–æ–≤
            if not —É—Å–ø–µ—Ö
        )
        
        return (–Ω–µ—É–¥–∞—á–Ω—ã—Ö_–∑–∞–ø—Ä–æ—Å–æ–≤ / –æ–±—â–µ–µ_–∑–∞–ø—Ä–æ—Å–æ–≤) * 100
    
    async def —Å–æ–±—Ä–∞—Ç—å_—Å–∏—Å—Ç–µ–º–Ω—ã–µ_–º–µ—Ç—Ä–∏–∫–∏(self):
        """–°–æ–±—Ä–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏."""
        try:
            —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ = await self.–ø–æ–ª—É—á–∏—Ç—å_—Å–∏—Å—Ç–µ–º–Ω—É—é_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É()
            –ª–æ–≥.info("–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±—Ä–∞–Ω—ã", **—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
            
        except Exception as e:
            –ª–æ–≥.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏", –æ—à–∏–±–∫–∞=str(e))
    
    async def –æ—á–∏—Å—Ç–∏—Ç—å_—Å—Ç–∞—Ä—ã–µ_–¥–∞–Ω–Ω—ã–µ(self):
        """–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏."""
        try:
            –ª–æ–≥.info("–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –æ—á–∏—â–µ–Ω—ã")
            
        except Exception as e:
            –ª–æ–≥.error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ", –æ—à–∏–±–∫–∞=str(e))
    
    async def –ø–æ–ª—É—á–∏—Ç—å_–º–µ—Ç—Ä–∏–∫–∏_–ø—Ä–æ–º–µ—Ç–µ—É—Å–∞(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus."""
        try:
            —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ = await self.–ø–æ–ª—É—á–∏—Ç—å_—Å–∏—Å—Ç–µ–º–Ω—É—é_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É()
            
            –º–µ—Ç—Ä–∏–∫–∏ = f"""# HELP russian_telegram_bot_users_total –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# TYPE russian_telegram_bot_users_total gauge
russian_telegram_bot_users_total {—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.get('–≤—Å–µ–≥–æ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 0)}

# HELP russian_telegram_bot_active_users –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–µ–≥–æ–¥–Ω—è
# TYPE russian_telegram_bot_active_users gauge  
russian_telegram_bot_active_users {—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.get('–∞–∫—Ç–∏–≤–Ω—ã—Ö_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π_—Å–µ–≥–æ–¥–Ω—è', 0)}

# HELP russian_telegram_bot_messages_total –°–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è
# TYPE russian_telegram_bot_messages_total counter
russian_telegram_bot_messages_total {—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.get('—Å–æ–æ–±—â–µ–Ω–∏–π_—Å–µ–≥–æ–¥–Ω—è', 0)}

# HELP russian_telegram_bot_response_time_seconds –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
# TYPE russian_telegram_bot_response_time_seconds gauge
russian_telegram_bot_response_time_seconds {—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.get('—Å—Ä–µ–¥–Ω–µ–µ_–≤—Ä–µ–º—è_–æ—Ç–≤–µ—Ç–∞', 0)}
"""
            
            return –º–µ—Ç—Ä–∏–∫–∏
            
        except Exception as e:
            –ª–æ–≥.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus", –æ—à–∏–±–∫–∞=str(e))
            return ""