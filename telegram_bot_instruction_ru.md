# Пошаговая инструкция по развертыванию Telegram‑AI‑бота

Этот документ предназначен для пользователей без опыта программирования, которые хотят настроить Telegram‑бота, использующего модель OpenAI GPT. Инструкция максимально подробная и поможет выполнить все действия самостоятельно.

## 1. Регистрация бота в Telegram

1. Откройте приложение **Telegram** на телефоне, планшете или через веб‑версию.
2. В поиске найдите бота `@BotFather` и начните с ним чат. Это официальный сервис для управления ботами.
3. Введите команду `/newbot` и нажмите отправить. BotFather попросит указать **имя** для вашего бота (это отображаемое имя), а затем **username** (уникальный идентификатор, который должен оканчиваться на `bot`, например, `my_test_agent_bot`).
4. После успешного создания BotFather пришлет вам **токен API** — длинную строку символов вида `123456789:ABCdefGhIJKlmNoPQRstUvwxYZ`. Этот токен обязательно сохраните в надежном месте — он нужен для работы бота.

## 2. Подготовка компьютера

### 2.1 Установка Python

1. Перейдите на официальный сайт [python.org](https://www.python.org/downloads/).
2. Скачайте последнюю стабильную версию Python 3 (рекомендуется версия не ниже 3.9). Для Windows установщик имеет расширение `.exe`, для macOS — `.pkg`. На Linux Python обычно уже установлен — проверьте командой `python3 --version` в терминале.
3. Запустите скачанный установщик и следуйте инструкциям. На Windows обязательно отметьте галочку **“Add Python to PATH”** перед нажатием «Install», чтобы система могла найти Python.
4. После установки откройте терминал (Command Prompt/PowerShell на Windows, Terminal на macOS/Linux) и выполните команду `python --version` или `python3 --version`. Должна отобразиться установленная версия Python.

### 2.2 Скачивание проекта

1. Если проект предоставлен как ZIP‑архив, распакуйте его в удобную папку, например `C:\\TelegramBot` на Windows или `~/telegram-bot` на Linux/macOS. 
2. Если вы используете Git, клонируйте репозиторий командой:
   ```
   git clone <ссылка_на_репозиторий>
   ```
   После клонирования перейдите в папку проекта:
   ```
   cd путь_к_папке_проекта
   ```

Внутри папки вы должны увидеть файлы `requirements.txt`, `schema.sql`, `Procfile` и др. Пример структуры каталога:

```
├── requirements.txt
├── schema.sql
├── Procfile
└── …
```

## 3. Создание и активация виртуального окружения

Использование виртуального окружения помогает изолировать библиотеки проекта от системных. Выполните следующие шаги:

1. Откройте терминал и перейдите в папку проекта (`cd путь_к_папке_проекта`).
2. Создайте виртуальное окружение командой (везде вместо `python` можно использовать `python3`, если это требуется):
   ```
   python -m venv venv
   ```
   Это создаст папку `venv` в каталоге проекта.
3. Активируйте окружение:
   - **Windows (Command Prompt):**
     ```
     venv\Scripts\activate
     ```
   - **Windows (PowerShell):**
     ```
     venv\Scripts\Activate.ps1
     ```
   - **macOS/Linux:**
     ```
     source venv/bin/activate
     ```
4. После активации вы увидите префикс `(venv)` в начале строки терминала. Это означает, что окружение активно.

## 4. Установка необходимых библиотек

В файле `requirements.txt` перечислены все зависимости проекта. Для установки выполните:

```bash
python -m pip install --upgrade pip  # обновляем менеджер пакетов
pip install -r requirements.txt
```

В список библиотек входят:

- **aiogram** — библиотека для написания Telegram‑ботов (версия 3 и выше);
- **aiohttp** — асинхронный HTTP‑клиент (нужен для работы с API);
- **asyncpg** — асинхронный драйвер для PostgreSQL;
- **openai** — клиент для обращения к API OpenAI.

После установки вы готовы писать код бота.

## 5. Настройка базы данных PostgreSQL

Бот использует PostgreSQL для хранения конфигурации и логов. Настройте БД так:

1. **Установка PostgreSQL.** Скачайте PostgreSQL с [официального сайта](https://www.postgresql.org/download/) и установите, следуя инструкциям. Запомните пароль суперпользователя `postgres`.
2. **Создание базы данных.** После установки можно использовать приложение **pgAdmin** (графический интерфейс) или командную строку. Для создания базы через команду:
   ```bash
   createdb telegram_bot
   ```
   В Windows эту команду можно выполнять через «SQL Shell (psql)» или в PowerShell, если psql доступен в PATH.
3. **Создание таблиц.** В каталоге проекта есть файл `schema.sql`, который создаёт таблицы `bot_config` и `logs`. Запустите его на созданной базе:
   ```bash
   psql -d telegram_bot -f schema.sql
   ```
   При первом запуске вас может попросить указать пароль пользователя `postgres`.

Теперь база готова к использованию.

## 6. Создание файла с переменными окружения

Все секретные данные (токен Telegram, ключ OpenAI, строка подключения к БД) удобнее хранить в отдельном файле `.env`. Это позволит легко изменять настройки без правки кода.

1. В корне проекта создайте файл `.env` (можно обычным текстовым редактором).
2. Добавьте в него строки:
   ```
   BOT_TOKEN=ваш_токен_бота_из_BotFather
   OPENAI_API_KEY=ваш_ключ_OpenAI
   DATABASE_URL=postgresql://postgres:ваш_пароль@localhost:5432/telegram_bot
   ```
   - `BOT_TOKEN` — токен, полученный от BotFather.
   - `OPENAI_API_KEY` — ваш секретный ключ с сайта OpenAI (его можно получить в личном кабинете [platform.openai.com](https://platform.openai.com/)).
   - `DATABASE_URL` — строка подключения к вашей базе данных: имя пользователя (`postgres`), пароль, адрес (`localhost`), порт (`5432`) и имя базы (`telegram_bot`).

## 7. Написание кода бота

В предоставленном архиве отсутствует папка `app` и сам код бота. Ниже приведён пример, который можно использовать как минимальную основу. Создайте новую папку `app` в каталоге проекта и файл `main.py` внутри неё.

```python
# app/main.py
import asyncio
import os
from aiogram import Bot, Dispatcher, types, F
from aiogram.enums import ParseMode

# Подгружаем токен из переменных окружения
BOT_TOKEN = os.getenv("BOT_TOKEN")

# Проверяем, что токен существует
if not BOT_TOKEN:
    raise ValueError("Переменная BOT_TOKEN не задана. Проверьте .env файл.")

bot = Bot(token=BOT_TOKEN, parse_mode=ParseMode.HTML)
dp = Dispatcher()

# Обработчик команды /start
@dp.message(F.text == "/start")
async def cmd_start(message: types.Message):
    await message.answer("Здравствуйте! Я AI‑бот. Отправьте мне любое сообщение, и я повторю его.")

# Обработчик любых текстовых сообщений (эхо)
@dp.message()
async def echo_message(message: types.Message):
    await message.answer(f"Вы написали: {message.text}")

async def main():
    # Запускаем polling
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
```

Этот код создаёт простого бота, который отвечает на команду `/start` и повторяет текст входящих сообщений. В будущем его можно расширить: добавить обработку команд `/suggest_prompt`, интеграцию с OpenAI (используя библиотеку `openai`), запись логов в базу данных с помощью `asyncpg` и т. д.

## 8. Запуск бота

1. Убедитесь, что виртуальное окружение активировано, а файл `.env` настроен.
2. В каталоге проекта выполните:
   ```bash
   python -m app.main
   ```
   или, если используется `python3`:
   ```bash
   python3 -m app.main
   ```
3. В терминале появится сообщение о запуске polling. Теперь откройте ваш бот в Telegram и отправьте команду `/start`. Бот должен ответить приветствием.

## 9. Развёртывание на хостинге

Чтобы бот работал 24/7 и не зависел от вашего компьютера, его можно развернуть в облаке (например, на Railway, Heroku или другом платформ‑как‑сервис).

1. **Подготовка Procfile.** В корне проекта уже есть файл `Procfile` со строкой:
   ```
   worker: python -m app.main
   ```
   Это говорит платформе, как запускать приложение.
2. **Регистрируемся на выбранной платформе** (например, railway.app) и создаём новый проект.
3. **Заливаем код** (через GitHub или команду CLI) и настраиваем переменные окружения (BOT_TOKEN, OPENAI_API_KEY, DATABASE_URL) в панели проекта.
4. **Развёртываем базу данных** (многие сервисы позволяют создать PostgreSQL‑инстанс в пару кликов). Не забудьте изменить `DATABASE_URL` на URL удалённой базы.
5. После деплоя бот станет доступен постоянно, даже если ваш компьютер выключен.

## 10. Дополнительные улучшения

1. **Интеграция с OpenAI:** используйте библиотеку `openai` для отправки запросов в GPT‑модель. Вопросы пользователей можно передавать в `openai.ChatCompletion.create()` и возвращать сгенерированный ответ.
2. **Запись логов:** для сохранения истории обращений создайте соединение с базой через `asyncpg` и добавляйте записи в таблицу `logs` каждый раз, когда бот отвечает пользователю.
3. **Генерация подсказок (suggest_prompt):** можно реализовать команду `/suggest_prompt`, которая будет анализировать историю диалогов и предлагать пользователю улучшить промпт — для этого понадобится обращение к OpenAI с анализом вопросов и ответов.

Следуя этой инструкции, вы сможете самостоятельно развернуть базовый Telegram‑AI‑бот. В дальнейшем код легко расширять, добавляя новые возможности.
